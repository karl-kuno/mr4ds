<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Ali Zaidi, alizaidi@microsoft.com" />
  <meta name="dcterms.date" content="2017-02-26" />
  <title>Introduction to R: Functional, Object-Based Computing for Data Analysis</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="1-intro-to-R_files/reveal.js-3.3.0/css/reveal.css"/>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="1-intro-to-R_files/reveal.js-3.3.0/css/theme/night.css" id="theme">

<style type="text/css">
.reveal section img {
  background: rgba(255, 255, 255, 0.85);
}
</style>

  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }

  </style>

    <style type="text/css">code{white-space: pre;}</style>

    <link rel="stylesheet" href="slides.css"/>
    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? '1-intro-to-R_files/reveal.js-3.3.0/css/print/pdf.css' : '1-intro-to-R_files/reveal.js-3.3.0/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <!--[if lt IE 9]>
    <script src="1-intro-to-R_files/reveal.js-3.3.0/lib/js/html5shiv.js"></script>
    <![endif]-->

</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Introduction to R: <em>Functional, Object-Based Computing for Data Analysis</em></h1>
    <h2 class="author"><a href="mailto:alizaidi@microsoft.com">Ali Zaidi, alizaidi@microsoft.com</a></h2>
    <h3 class="date">February 26, 2017</h3>
</section>

<section><section id="course-logistics" class="titleslide slide level1"><h1>Course Logistics</h1></section><section id="day-one" class="slide level2">
<h1>Day One</h1>
<h3 id="r-u-ready">R U Ready?</h3>
<ul>
<li class="fragment">Overview of The R Project for Statistical Computing</li>
<li class="fragment">The Microsoft R Family</li>
<li class="fragment">R’s capabilities and it’s limitations</li>
<li class="fragment">What types of problems R might be useful for</li>
<li class="fragment">How to manage data with the exceptionally popular open source package <code>dplyr</code></li>
<li class="fragment">How to develop models and write functions in R</li>
</ul>
</section><section id="day-two" class="slide level2">
<h1>Day Two</h1>
<h3 id="scalable-data-analysis-with-microsoft-r">Scalable Data Analysis with Microsoft R</h3>
<ul>
<li class="fragment">Moving the compute to your data</li>
<li class="fragment">WODA - Write Once, Deploy Anywhere</li>
<li class="fragment">High Performance Analytics</li>
<li class="fragment">High Performance Computing</li>
<li class="fragment">Machine Learning with Microsoft R</li>
</ul>
</section><section id="day-three" class="slide level2">
<h1>Day Three</h1>
<h3 id="distributing-computing-on-spark-clusters-with-r">Distributing Computing on Spark Clusters with R</h3>
<ul>
<li class="fragment">Overview of the Apache Spark Project</li>
<li class="fragment">Taming the Hadoop Zoo with HDInsight</li>
<li class="fragment">Provisioing and Managing HDInsight Clusters</li>
<li class="fragment">Spark DataFrames, <code>SparkR</code>, and the <code>sparklyr</code> package</li>
<li class="fragment">Developing Machine Learning Pipelines with <code>Spark</code> and Microsoft R</li>
</ul>
</section><section id="prerequisites" class="slide level2">
<h1>Prerequisites</h1>
<h3 id="computing-environments">Computing Environments</h3>
<ul>
<li class="fragment">R Server 8.0.5 or above (most recent version is 9.0.2)</li>
<li class="fragment">Azure Credits</li>
<li class="fragment">Can use the <a href="https://azure.microsoft.com/en-us/documentation/articles/machine-learning-data-science-linux-dsvm-intro/">Linux DSVM</a></li>
<li class="fragment">Or the <a href="https://azure.microsoft.com/en-us/documentation/articles/machine-learning-data-science-provision-vm/">Windows DSVM</a></li>
<li class="fragment">For IDE: choises are <a href="https://www.visualstudio.com/vs/rtvs/">RTVS</a>, <a href="https://www.rstudio.com/products/rstudio/download3/">RStudio Server</a>, <a href="https://jupyterhub.readthedocs.io/en/latest/">JupyterHub</a>, <a href="http://jupyterlab-tutorial.readthedocs.io/en/latest/">JupyterLab</a>…
<ul>
<li class="fragment">Whatever you’re comfortable with!</li>
</ul></li>
</ul>
</section><section id="development-environments" class="slide level2">
<h1>Development Environments</h1>
<h3 id="where-to-write-r-code">Where to Write R Code</h3>
<ul>
<li class="fragment">The most popular integrated development environment for R is <a href="https://www.rstudio.com/">RStudio</a></li>
<li class="fragment">The RStudio IDE is entirely html/javascript based, so completely cross-platform</li>
<li class="fragment">RStudio Server provides a full IDE in your browser: perfect for cloud instances</li>
<li class="fragment">For Windows machines, 2016 provided general availability of <a href="https://www.visualstudio.com/en-us/features/rtvs-vs.aspx">R Tools for Visual Studio, RTVS</a></li>
<li class="fragment">RTVS supports connectivity to Azure and SQL Server for remote connectivity</li>
</ul>
</section><section id="what-is-r" class="slide level2">
<h1>What is R?</h1>
<h3 id="why-should-i-care">Why should I care?</h3>
<ul>
<li class="fragment">R is the successor to the S Language, originated at Bell Labs AT&amp;T</li>
<li class="fragment">It is based on the Scheme interpreter</li>
<li class="fragment">Originally designed by two University of Auckland Professors for their introductory statistics course</li>
</ul>
<p><img src="http://revolution-computing.typepad.com/.a/6a010534b1db25970b016766fdae38970b-800wi" alt="Robert Gentleman and Ross Ihaka" /></p>
</section><section id="rs-philosophy" class="slide level2">
<h1>R’s Philosophy</h1>
<h3 id="what-r-thou">What R Thou?</h3>
<p>R follows the <a href="http://en.wikipedia.org/wiki/Unix_philosophy">Unix philosophy</a></p>
<ul>
<li class="fragment">Write programs that do one thing and do it well (modularity)</li>
<li class="fragment">Write programs that work together (cohesiveness)</li>
<li class="fragment">R is extensible with more than 10,000 packages available at CRAN (<a href="http://crantastic.org/packages" class="uri">http://crantastic.org/packages</a>)</li>
</ul>
</section><section id="the-art-of-being-lazy" class="slide level2">
<h1>The aRt of Being Lazy</h1>
<h3 id="lazy-evaluation-in-r">Lazy Evaluation in R</h3>
<p><img src="http://i.imgur.com/5GbW690.gif" /></p>
<ul>
<li class="fragment">R, like it’s inspiration, Scheme, is a <em>functional</em> programming language</li>
<li class="fragment">R evaluates lazily, delaying evaluation until necessary, which can make it very flexible</li>
<li class="fragment">R is a highly interpreted dynamically typed language, allowing you to mutate variables and analyze datasets quickly, but is significantly slower than low-level, statically typed languages like C or Java</li>
<li class="fragment">R has a high memory footprint, and can easily lead to crashes if you aren’t careful</li>
</ul>
</section><section id="rs-programming-paradigm" class="slide level2">
<h1>R’s Programming Paradigm</h1>
<h3 id="keys-to-r">Keys to R</h3>
<p><span class="fragment">Everything that exist in R is an <em>object</em></span> <br> <span class="fragment">Everything that happens in R is a <em>function call</em></span> <br> <span class="fragment">R was born to <em>interface</em></span> <br></p>
<p><span class="fragment"><em>—John Chambers</em></span></p>
</section><section id="strengths-of-r" class="slide level2">
<h1>Strengths of R</h1>
<h3 id="where-r-succeeds">Where R Succeeds</h3>
<ul>
<li class="fragment">Expressive</li>
<li class="fragment">Open source</li>
<li class="fragment">Extendable – nearly 10,000 packages with functions to use, and that list continues to grow</li>
<li class="fragment">Focused on statistics and machine learning – cutting-edge algorithms and powerful data manipulation packages</li>
<li class="fragment">Advanced data structures and graphical capabilities</li>
<li class="fragment">Large user community, both within academia and industry</li>
<li class="fragment">It is designed by statisticians</li>
</ul>
</section><section id="weaknesses-of-r" class="slide level2">
<h1>Weaknesses of R</h1>
<h3 id="where-r-falls-short">Where R Falls Short</h3>
<ul>
<li class="fragment">It is designed by statisticians</li>
<li class="fragment">Inefficient at element-by-element computations</li>
<li class="fragment">May make large demands on system resources, namely memory</li>
<li class="fragment">Data capacity limited by memory</li>
<li class="fragment">Single-threaded</li>
</ul>
</section><section id="distributions-of-r" class="slide level2">
<h1>Distributions of R</h1>
<p><img src="/datadrive/LearnAnalytics-mr4ds-spark/mr4ds/Student-Resources/rmarkdown/images/distros_r.png" /></p>
</section><section id="some-essential-open-source-packages" class="slide level2">
<h1>Some Essential Open Source Packages</h1>
<ul>
<li class="fragment">There are over 10,000 R packages to choose from, what do I start with?</li>
<li class="fragment">Data Management: <code>dplyr</code>, <code>tidyr</code>, <code>data.table</code></li>
<li class="fragment">Visualization: <code>ggplot2</code>, <code>ggvis</code>, <code>htmlwidgets</code>, <code>shiny</code></li>
<li class="fragment">Data Importing: <code>haven</code>, <code>RODBC</code>, <code>readr</code>, <code>foreign</code></li>
<li class="fragment">Other favorites: <code>magrittr</code>, <code>rmarkdown</code>, <code>caret</code></li>
</ul>
</section></section>
<section><section id="r-foundations" class="titleslide slide level1"><h1>R Foundations</h1></section><section id="command-line-prompts" class="slide level2">
<h1>Command line prompts</h1>
<table>
<thead>
<tr class="header">
<th>Symbol</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&lt;-</code></td>
<td>assignment operator</td>
</tr>
<tr class="even">
<td><code>&gt;</code></td>
<td>ready for a new command</td>
</tr>
<tr class="odd">
<td><code>+</code></td>
<td>awaiting the completion of an existing command</td>
</tr>
<tr class="even">
<td><code>?</code></td>
<td>get help for following function</td>
</tr>
</tbody>
</table>
<p>Can change options either permanently at startup (see <code>?Startup</code>) or manually at each session with the <code>options</code> function, <code>options(repos = &quot; &quot;)</code> for example.</p>
<p>Check your CRAN mirror with <code>getOption(&quot;repos&quot;)</code>.</p>
</section><section id="im-lost" class="slide level2">
<h1>I’m Lost!</h1>
<h3 id="getting-help-for-r">Getting Help for R</h3>
<ul>
<li class="fragment"><a href="http://stackoverflow.com/questions/tagged/r">Stack Overflow</a></li>
<li class="fragment"><a href="https://cran.r-project.org/doc/contrib/Short-refcard.pdf">R Reference Card</a></li>
<li class="fragment"><a href="https://www.rstudio.com/resources/cheatsheets/">RStudio Cheat Sheets</a></li>
<li class="fragment"><a href="https://stat.ethz.ch/mailman/listinfo/r-help">R help mailing list and archives</a></li>
<li class="fragment"><a href="http://blog.revolutionanalytics.com/">Revolutions Blog</a></li>
<li class="fragment"><a href="http://www.r-bloggers.com/">R-Bloggers</a></li>
<li class="fragment"><a href="rseek.org">RSeek</a></li>
<li class="fragment"><a href="https://www.rdocumentation.org/">RDocumentation</a></li>
</ul>
</section><section id="quick-tour-of-things-you-need-to-know" class="slide level2">
<h1>Quick Tour of Things You Need to Know</h1>
<h3 id="data-structures">Data Structures</h3>
<blockquote>
<p>“Bad programmers worry about the code. Good programmers worry about data structures and their relationships.” - Linus Torvalds</p>
</blockquote>
<ul>
<li class="fragment">R’s data structures can be described by their dimensionality, and their type.</li>
</ul>
<table>
<thead>
<tr class="header">
<th></th>
<th>Homogeneous</th>
<th>Heterogeneous</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1d</td>
<td>Atomic vector</td>
<td>List</td>
</tr>
<tr class="even">
<td>2d</td>
<td>Matrix</td>
<td>Data frame</td>
</tr>
<tr class="odd">
<td>nd</td>
<td>Array</td>
<td></td>
</tr>
</tbody>
</table>
</section><section id="quick-tour-of-things-you-need-to-know-1" class="slide level2">
<h1>Quick Tour of Things You Need to Know</h1>
<h3 id="data-types">Data Types</h3>
<ul>
<li class="fragment">Atomic vectors come in one of four types</li>
<li class="fragment"><code>logical</code> (boolean). Values: <code>TRUE</code> | <code>FALSE</code></li>
<li class="fragment"><code>integer</code></li>
<li class="fragment"><code>double</code> (often called numeric)</li>
<li class="fragment"><code>character</code></li>
<li class="fragment">Rare types:</li>
<li class="fragment"><code>complex</code></li>
<li class="fragment"><code>raw</code></li>
</ul>
</section><section id="manipulating-data-structures" class="slide level2">
<h1>Manipulating Data Structures</h1>
<h3 id="subsetting-operators">Subsetting Operators</h3>
<ul>
<li class="fragment">To create a vector, use <code>c</code>: <code>c(1, 4, 1, 3)</code></li>
<li class="fragment">To create a list, use <code>list</code>: <code>list(1, 'hi', data.frame(1:10, letters[1:10]))</code></li>
<li class="fragment">To subset a vector or list, use the <code>[ ]</code></li>
<li class="fragment">inside the brackets:
<ul>
<li class="fragment">positive integer vectors for indices you want</li>
<li class="fragment">negative integer vectors for indices you want to drop</li>
<li class="fragment">logical vectors for indices you want to keep/drop (TRUE/FALSE)</li>
<li class="fragment">character vectors for named vectors corresponding to which named elements you want to keep</li>
<li class="fragment">subsetting a list with a single square bracket always returns a list</li>
</ul></li>
<li class="fragment">To subset a list and get back just that element, use <code>[[ ]]</code></li>
</ul>
<h3 id="object-representation">Object Representation</h3>
<ul>
<li class="fragment">To find the type of an object, use <code>class</code> (<em>higher level representation</em>)</li>
<li class="fragment">To find how the object is stored in memory, use <code>typeof</code> (<em>lower level representation</em>)</li>
<li class="fragment">Good time to do Lab 1!</li>
</ul>
</section></section>
<section><section id="data-manipulation-with-the-dplyr-package" class="titleslide slide level1"><h1>Data Manipulation with the <code>dplyr</code> Package</h1></section><section id="overview" class="slide level2">
<h1>Overview</h1>
<p>Rather than describing the nitty gritty details of writing R code, I’d like you to get started at immediately writing R code.</p>
<p>As most of you are data scientists/data enthusiasts, I will showcase one of the most useful data manipulation packages in R, <code>dplyr</code>. At the end of this session, you will have learned:</p>
<ul>
<li class="fragment">How to manipulate data quickly with <code>dplyr</code> using a very intuitive <em>“grammar”</em></li>
<li class="fragment">How to use <code>dplyr</code> to perform common exploratory analysis data manipulation procedures</li>
<li class="fragment">How to apply your own custom functions to group manipulations <code>dplyr</code> with <code>mutate()</code>, <code>summarise()</code> and <code>do()</code></li>
<li class="fragment">Connect to remote databases to work with larger than memory datasets</li>
</ul>
</section><section id="why-use-dplyr" class="slide level2">
<h1>Why use dplyr?</h1>
<h3 id="the-grammar-of-data-manipulation">The Grammar of Data Manipulation</h3>
<ul>
<li class="fragment"><code>dplyr</code> is currently the <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.5.0?">most downloaded package</a> from CRAN</li>
<li class="fragment"><code>dplyr</code> makes data manipulation easier by providing a few functions for the most common tasks and procedures</li>
<li class="fragment"><code>dplyr</code> achieves remarkable speed-up gains by using a C++ backend</li>
<li class="fragment"><code>dplyr</code> has multiple backends for working with data stored in various sources: SQLite, MySQL, bigquery, SQL Server, and many more</li>
<li class="fragment"><code>dplyr</code> was inspired to give data manipulation a simple, cohesive grammar (similar philosophy to <code>ggplot</code> - grammar of graphics)</li>
<li class="fragment"><code>dplyr</code> has inspired many new packages, which now adopt it’s easy to understand syntax.</li>
<li class="fragment">The recent packages <code>dplyrXdf</code> and <code>SparkR/sparklyr</code> brings much of the same functionality of <code>dplyr</code> to <code>XDF</code>s data and Spark <code>DataFrames</code></li>
</ul>
</section><section id="tidy-data-and-happier-coding" class="slide level2">
<h1>Tidy Data and Happier Coding</h1>
<h3 id="premature-optimization">Premature Optimization</h3>
<p><img src="https://imgs.xkcd.com/comics/the_general_problem.png" /></p>
<ul>
<li class="fragment">For a dats scientist, the most important parameter to optimize in a data science development cycle is YOUR time</li>
<li class="fragment">It is therefore important to be able to write efficient code, quickly</li>
<li class="fragment">Goals: writing fast code that is: portable, platform invariant, easy to understand, and easy to debug
<ul>
<li class="fragment"><strong>Be serious about CReUse</strong>!</li>
</ul></li>
</ul>
</section><section id="manipulation-verbs" class="slide level2">
<h1>Manipulation verbs</h1>
<dl>
<dt class="fragment"><code>filter</code></dt>
<dd class="fragment"><p>select rows based on matching criteria</p>
</dd>
<dt class="fragment"><code>slice</code></dt>
<dd class="fragment"><p>select rows by number</p>
</dd>
<dt class="fragment"><code>select</code></dt>
<dd class="fragment"><p>select columns by column names</p>
</dd>
<dt class="fragment"><code>arrange</code></dt>
<dd class="fragment"><p>reorder rows by column values</p>
</dd>
<dt class="fragment"><code>mutate</code></dt>
<dd class="fragment"><p>add new variables based on transformations of existing variables</p>
</dd>
<dt class="fragment"><code>transmute</code></dt>
<dd class="fragment"><p>transform and drop other variables</p>
</dd>
</dl>
</section><section id="aggregation-verbs" class="slide level2">
<h1>Aggregation verbs</h1>
<dl>
<dt class="fragment"><code>group_by</code></dt>
<dd class="fragment"><p>identify grouping variables for calculating groupwise summary statistics</p>
</dd>
<dt class="fragment"><code>count</code></dt>
<dd class="fragment"><p>count the number of records per group</p>
</dd>
<dt class="fragment"><code>summarise</code> | <code>summarize</code></dt>
<dd class="fragment"><p>calculate one or more summary functions per group, returning one row of results per group (or one for the entire dataset)</p>
</dd>
</dl>
</section><section id="nyc-taxi-data" class="slide level2">
<h1>NYC Taxi Data</h1>
<h3 id="data-for-class">Data for Class</h3>
<ul>
<li class="fragment">The data we will be examining in this module is dervided from the <a href="http://www.nyc.gov/html/tlc/html/home/home.shtml">NYC Taxi and Limousine Commission</a></li>
<li class="fragment">Data contains taxi trips in NYC, and includes spatial features (pickup and dropoff neighborhoods), temporal features, and monetary features (fare and tip amounts)</li>
<li class="fragment">The dataset for this module is saved as an <em>rds</em> file in a public facing Azure storage blob</li>
<li class="fragment">An <em>rds</em> file is a compressed, serialized R object</li>
<li class="fragment">Save an object to <em>rds</em> by using the <code>saveRDS</code> function; read an <em>rds</em> object with the <code>readRDS</code> object</li>
</ul>
</section><section id="viewing-data" class="slide level2">
<h1>Viewing Data</h1>
<h3 id="tibble">tibble</h3>
<ul>
<li class="fragment"><code>dplyr</code> includes a wrapper called <code>tbl_df</code> that adds an additional class attribute onto <code>data.frames</code> that provides some better data manipulation aesthetics (there’s now a dedicated package <a href="www.github.com/hadley/tibble"><code>tibble</code></a> for this wrapper and it’s class)</li>
<li class="fragment">Most noticeable differential between <code>tbl_df</code> and <code>data.frame</code>s is the console output: <code>tbl_df</code>s will only print what the current R console window can display</li>
<li class="fragment">Can change the default setting for number of displayed columns by changing the options parameter: <code>options(dplyr.width = Inf)</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(stringr)
taxi_url &lt;-<span class="st"> &quot;http://alizaidi.blob.core.windows.net/training/trainingData/manhattan_df.rds&quot;</span>
taxi_df  &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">gzcon</span>(<span class="kw">url</span>(taxi_url)))
(taxi_df &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(taxi_df))</code></pre></div>
<pre><code>## # A tibble: 5,000,000 × 21
##    VendorID passenger_count trip_distance pickup_longitude pickup_latitude
##       &lt;int&gt;           &lt;int&gt;         &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
## 1         1               1          1.40        -74.00555        40.72562
## 2         2               2          4.58        -73.98419        40.73022
## 3         2               5          9.63        -73.97183        40.76273
## 4         1               1          1.70        -73.96131        40.77190
## 5         1               2          0.60        -73.99568        40.72430
## 6         1               1          4.10        -73.95731        40.76214
## 7         2               5          1.76        -73.99208        40.72919
## 8         2               1          2.68        -73.95257        40.78289
## 9         2               1          1.69        -73.94909        40.78134
## 10        2               1          1.16        -73.98251        40.76832
## # ... with 4,999,990 more rows, and 16 more variables: RatecodeID &lt;int&gt;,
## #   store_and_fwd_flag &lt;chr&gt;, dropoff_longitude &lt;dbl&gt;,
## #   dropoff_latitude &lt;dbl&gt;, payment_type &lt;int&gt;, fare_amount &lt;dbl&gt;,
## #   tip_amount &lt;dbl&gt;, tolls_amount &lt;dbl&gt;, tip_percent &lt;dbl&gt;,
## #   pickup_hour &lt;fctr&gt;, pickup_dow &lt;fctr&gt;, dropoff_hour &lt;fctr&gt;,
## #   dropoff_dow &lt;fctr&gt;, trip_duration &lt;int&gt;, pickup_nhood &lt;fctr&gt;,
## #   dropoff_nhood &lt;fctr&gt;</code></pre>
</section></section>
<section><section id="filtering-and-reordering-data" class="titleslide slide level1"><h1>Filtering and Reordering Data</h1></section><section id="subsetting-data" class="slide level2">
<h1>Subsetting Data</h1>
<ul>
<li class="fragment"><code>dplyr</code> makes subsetting by rows very easy</li>
<li class="fragment">The <code>filter</code> verb takes conditions for filtering rows based on conditions</li>
<li class="fragment"><strong>every</strong> <code>dplyr</code> function uses a data.frame/tbl as it’s first argument</li>
<li class="fragment">Additional conditions are passed as new arguments (no need to make an insanely complicated expression, split em up!)</li>
</ul>
</section><section id="filter" class="slide level2">
<h1>Filter</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(taxi_df,
       dropoff_dow %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Fri&quot;</span>, <span class="st">&quot;Sat&quot;</span>, <span class="st">&quot;Sun&quot;</span>),
       tip_amount &gt;<span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## # A tibble: 1,120,381 × 21
##    VendorID passenger_count trip_distance pickup_longitude pickup_latitude
##       &lt;int&gt;           &lt;int&gt;         &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
## 1         2               5          1.76        -73.99208        40.72919
## 2         1               1          3.20        -73.98829        40.76429
## 3         2               3          1.86        -73.97189        40.75711
## 4         1               2         17.30        -73.78173        40.64448
## 5         1               1          1.30        -73.94249        40.79044
## 6         1               1          2.80        -73.96978        40.75972
## 7         2               1          4.65        -73.98398        40.73781
## 8         1               2          1.50        -73.96262        40.77548
## 9         2               2          0.83        -73.97236        40.78106
## 10        2               6         11.32        -73.98249        40.76269
## # ... with 1,120,371 more rows, and 16 more variables: RatecodeID &lt;int&gt;,
## #   store_and_fwd_flag &lt;chr&gt;, dropoff_longitude &lt;dbl&gt;,
## #   dropoff_latitude &lt;dbl&gt;, payment_type &lt;int&gt;, fare_amount &lt;dbl&gt;,
## #   tip_amount &lt;dbl&gt;, tolls_amount &lt;dbl&gt;, tip_percent &lt;dbl&gt;,
## #   pickup_hour &lt;fctr&gt;, pickup_dow &lt;fctr&gt;, dropoff_hour &lt;fctr&gt;,
## #   dropoff_dow &lt;fctr&gt;, trip_duration &lt;int&gt;, pickup_nhood &lt;fctr&gt;,
## #   dropoff_nhood &lt;fctr&gt;</code></pre>
</section><section id="exercise" class="slide level2">
<h1>Exercise</h1>
<p>Your turn:</p>
<ul>
<li class="fragment">How many observations started in Harlem?</li>
<li class="fragment">pick both sides of Harlem, including east harlem</li>
<li class="fragment"><em>hint</em>: it might be useful to use the <code>str_detect</code> function from <code>stringr</code></li>
<li class="fragment">How many observations that started in Harlem ended in the Financial District?</li>
</ul>
</section><section id="solution" class="slide level2">
<h1>Solution</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
<span class="kw">table</span>(taxi_df$pickup_nhood)</code></pre></div>
<pre><code>## 
##                              Annadale 
##                                     0 
##                         Arden Heights 
##                                     0 
##                              Arrochar 
##                                     3 
##                               Arverne 
##                                     6 
##                               Astoria 
##                                 23432 
##                       Astoria Heights 
##                                   552 
##                            Auburndale 
##                                    16 
##                            Bath Beach 
##                                    46 
##                          Battery Park 
##                                 50258 
##                             Bay Ridge 
##                                   154 
##                           Bay Terrace 
##                                     7 
##                            Baychester 
##                                     4 
##                               Bayside 
##                                    25 
##                          Bedford Park 
##                                    48 
##                    Bedford Stuyvesant 
##                                  4560 
##                          Belle Harbor 
##                                     1 
##                             Bellerose 
##                                    23 
##                               Belmont 
##                                    33 
##                           Bensonhurst 
##                                    70 
##                          Bergen Beach 
##                                     5 
##                            Blissville 
##                                   132 
##                            Bloomfield 
##                                     3 
##                           Boerum Hill 
##                                  3734 
##                          Borough Park 
##                                    60 
##                          Breezy Point 
##                                     2 
##                             Briarwood 
##                                   285 
##                        Brighton Beach 
##                                    34 
##                         Broad Channel 
##                                     2 
##                            Bronx Park 
##                                    14 
##                      Brooklyn Heights 
##                                  5876 
##                           Brownsville 
##                                    78 
##                            Bulls Head 
##                                     3 
##                              Bushwick 
##                                  1877 
##                          Butler Manor 
##                                     0 
##                       Cambria Heights 
##                                    12 
##                              Canarsie 
##                                   102 
##                         Carnegie Hill 
##                                 56133 
##                       Carroll Gardens 
##                                  3807 
##                           Castle Hill 
##                                    19 
##                     Castleton Corners 
##                                     2 
##                          Central Park 
##                                 68716 
##                            Charleston 
##                                     0 
##                               Chelsea 
##                                237331 
##                        Chelsea-Travis 
##                                     1 
##                             Chinatown 
##                                 16261 
##                           City Island 
##                                     5 
##                          Clason Point 
##                                     0 
##                               Clifton 
##                                     8 
##                               Clinton 
##                                154194 
##                          Clinton Hill 
##                                  2007 
##                            Clove Lake 
##                                     0 
##                            Co-op City 
##                                    20 
##                           Cobble Hill 
##                                  2122 
##                         College Point 
##                                    55 
##   Columbia Street Waterfront District 
##                                   286 
##                       Columbus Circle 
##                                 80557 
##                             Concourse 
##                                   862 
##                          Coney Island 
##                                    20 
##                                Corona 
##                                   434 
##                          Country Club 
##                                     3 
##                         Crown Heights 
##                                  2001 
##                          Dongan Hills 
##                                     1 
##                Douglaston-Little Neck 
##                                     7 
##                              Downtown 
##                                  9444 
##                                 DUMBO 
##                                  1720 
##                         Dyker Heights 
##                                    32 
##                         East Elmhurst 
##                                  2887 
##                         East Flatbush 
##                                   278 
##                           East Harlem 
##                                 49635 
##              East Jamaica Bay Islands 
##                                     1 
##                         East New York 
##                                   287 
##                          East Tremont 
##                                    54 
##                          East Village 
##                                180604 
##                           Eastchester 
##                                     5 
##                              Elm Park 
##                                     0 
##                              Elmhurst 
##                                  2244 
##                           Eltingville 
##                                     1 
##                          Emerson Hill 
##                                     1 
##                          Far Rockaway 
##                                    24 
##                             Fieldston 
##                                    11 
##                    Financial District 
##                                 96110 
##                              Flatbush 
##                                   896 
##                     Flatiron District 
##                                319998 
##                             Flatlands 
##                                    85 
##                           Floral park 
##                                    13 
##                   Floyd Bennett Field 
##                                     6 
##                              Flushing 
##                                   341 
##          Flushing Meadows Corona Park 
##                                   280 
##                               Fordham 
##                                    67 
##                          Forest Hills 
##                                   997 
##                  Forest Hills Gardens 
##                                     8 
##                           Fort Greene 
##                                  5164 
##                         Fort Hamilton 
##                                    86 
##                           Fort Tilden 
##                                     0 
##                        Fort Wadsworth 
##                                     3 
##                           Fresh Kills 
##                                     0 
##                      Fresh Kills Park 
##                                     0 
##                         Fresh Meadows 
##                                    29 
##                      Garment District 
##                                296479 
##                            Georgetown 
##                                     6 
##                       Gerritsen Beach 
##                                     1 
##                             Glen Oaks 
##                                     5 
##                              Glendale 
##                                    42 
##                      Governors Island 
##                                     1 
##                               Gowanus 
##                                  2226 
##                              Gramercy 
##                                170535 
##                          Graniteville 
##                                     0 
##                            Grant City 
##                                     0 
##                    Grasmere - Concord 
##                                     3 
##                             Gravesend 
##                                    59 
##                           Great Kills 
##                                     1 
##                            Greenpoint 
##                                  4106 
##                            Greenridge 
##                                     0 
##                     Greenwich Village 
##                                210108 
##                             Greenwood 
##                                   647 
##                           Grymes Hill 
##                                     2 
##                      Hamilton Heights 
##                                  6657 
##                                Harlem 
##                                 22344 
##                     Heartland Village 
##                                     1 
##                           High Bridge 
##                                   153 
##                             Hillcrest 
##                                    43 
##                                Hollis 
##                                    93 
##                            Holliswood 
##                                     5 
##                             Homecrest 
##                                    40 
##                          Howard Beach 
##                                    29 
##                              Huguenot 
##                                     0 
##                         Hunters Point 
##                                  7163 
##                           Hunts Point 
##                                    11 
##                                Inwood 
##                                   438 
##                       Jackson Heights 
##                                  1478 
##                       Jacob Riis Park 
##                                     0 
##                               Jamaica 
##                                  1386 
##                       Jamaica Estates 
##                                    22 
##                         Jamaica Hills 
##                                    64 
## John F. Kennedy International Airport 
##                                111064 
##                            Kensington 
##                                   447 
##                           Kew Gardens 
##                                   250 
##                     Kew Gardens Hills 
##                                   102 
##                           Kingsbridge 
##                                   106 
##                    La Guardia Airport 
##                                127232 
##                      La Tourette Park 
##                                     0 
##                             Laurelton 
##                                    25 
##                        Liberty Island 
##                                     0 
##                       Lighthouse Hill 
##                                     0 
##                          Little Italy 
##                                 38778 
##                              Longwood 
##                                    67 
##                       Lower East Side 
##                                103048 
##                                 Malba 
##                                     1 
##                       Manhattan Beach 
##                                     6 
##                        Manhattanville 
##                                  3181 
##                           Marble Hill 
##                                    54 
##                           Marine Park 
##                                    12 
##                      Mariner&#39;s Harbor 
##                                     0 
##                               Maspeth 
##                                   801 
##                        Meiers Corners 
##                                     0 
##                               Melrose 
##                                   197 
##                        Middle Village 
##                                    76 
##                         Midland Beach 
##                                     3 
##                               Midtown 
##                                575401 
##                               Midwood 
##                                    82 
##                            Mill Basin 
##                                    11 
##                        Mill Rock Park 
##                                     0 
##                   Morningside Heights 
##                                 23385 
##                        Morris Heights 
##                                   106 
##                           Morris Park 
##                                    46 
##                            Mott Haven 
##                                   911 
##                           Murray Hill 
##                                125374 
##                             Navy Yard 
##                                    72 
##                              Neponsit 
##                                     0 
##                          New Brighton 
##                                    37 
##                              New Dorp 
##                                     0 
##                        New Dorp Beach 
##                                     0 
##                       New Springville 
##                                     1 
##                           New Utrecht 
##                                    20 
##                                  NoHo 
##                                 46345 
##                       North Riverdale 
##                                    20 
##                               Norwood 
##                                    43 
##                       Oakland Gardens 
##                                     8 
##                               Oakwood 
##                                     3 
##                            Ocean Hill 
##                                   115 
##                         Ocean Parkway 
##                                   167 
##                              Old Town 
##                                     0 
##                            Ozone Park 
##                                   124 
##                             Park Hill 
##                                     2 
##                            Park Slope 
##                                  6947 
##                           Parkchester 
##                                    82 
##                            Pelham Bay 
##                                    23 
##                       Pelham Bay Park 
##                                     2 
##                        Pelham Gardens 
##                                    21 
##                       Pleasant Plains 
##                                     0 
##                               Pomonok 
##                                     8 
##                            Port Ivory 
##                                     1 
##                           Port Morris 
##                                   296 
##                         Port Richmond 
##                                     2 
##                          Prince&#39;s Bay 
##                                     1 
##                      Prospect Heights 
##                                  2594 
##             Prospect Lefferts Gardens 
##                                   638 
##                         Prospect Park 
##                                   157 
##                   Prospect Park South 
##                                    37 
##                        Queens Village 
##                                    69 
##                         Randall Manor 
##                                     1 
##                  Randals-Wards Island 
##                                   327 
##                              Red Hook 
##                                   445 
##                             Rego Park 
##                                   510 
##                         Richmond Hill 
##                                   150 
##                         Richmond Town 
##                                     1 
##                       Richmond Valley 
##                                     0 
##                             Ridgewood 
##                                   248 
##                         Rikers Island 
##                                     3 
##                             Riverdale 
##                                    40 
##                              Rochdale 
##                                    44 
##                        Rockaway Beach 
##                                     0 
##                         Rockaway Park 
##                                     1 
##                      Roosevelt Island 
##                                   367 
##                              Rosebank 
##                                    13 
##                              Rosedale 
##                                    15 
##                             Rossville 
##                                     1 
##                               Roxbury 
##                                     0 
##                        Sheepshead Bay 
##                                    83 
##                           Shore Acres 
##                                     0 
##                           Silver Lake 
##                                     6 
##                                  SoHo 
##                                 87588 
##                             Soundview 
##                                   106 
##                           South Beach 
##                                     1 
##                           South Bronx 
##                                   168 
##                      South Ozone Park 
##                                   755 
##                   Springfield Gardens 
##                                    98 
##                        Spuyten Duyvil 
##                                    34 
##                            St. Albans 
##                                    17 
##                            St. George 
##                                     3 
##                             Stapleton 
##                                    25 
##                       Stuyvesant Town 
##                                  9438 
##                             Sunnyside 
##                                  8704 
##                           Sunset Park 
##                                   325 
##                          Sutton Place 
##                                 81233 
##                          Throggs Neck 
##                                    34 
##                             Todt Hill 
##                                     0 
##                         Tompkinsville 
##                                     6 
##                           Tottenville 
##                                     0 
##                               Tremont 
##                                    89 
##                               Tribeca 
##                                 97257 
##                            Tudor City 
##                                 49655 
##                            Turtle Bay 
##                                128532 
##                             Unionport 
##                                    50 
##                    University Heights 
##                                    82 
##                       Upper East Side 
##                                680256 
##                       Upper West Side 
##                                414113 
##                                Utopia 
##                                     1 
##                    Van Cortlandt Park 
##                                    10 
##                              Van Nest 
##                                    16 
##                          Vinegar Hill 
##                                    23 
##                             Wakefield 
##                                     9 
##                    Washington Heights 
##                                  6025 
##                         West Brighton 
##                                     5 
##                            West Farms 
##                                    34 
##              West Jamaica Bay Islands 
##                                     1 
##                          West Village 
##                                124493 
##                   Westchester Heights 
##                                    28 
##                           Westerleigh 
##                                     0 
##                            Whitestone 
##                                    24 
##                        Williamsbridge 
##                                    64 
##                          Williamsburg 
##                                 24258 
##                           Willowbrook 
##                                     0 
##                       Windsor Terrace 
##                                   178 
##                               Wingate 
##                                    71 
##                             Woodhaven 
##                                    64 
##                              Woodlawn 
##                                    21 
##                               Woodrow 
##                                     0 
##                              Woodside 
##                                  3482</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">harlem_pickups &lt;-<span class="st"> </span><span class="kw">filter</span>(taxi_df, <span class="kw">str_detect</span>(pickup_nhood, <span class="st">&quot;Harlem&quot;</span>))
harlem_pickups</code></pre></div>
<pre><code>## # A tibble: 71,979 × 21
##    VendorID passenger_count trip_distance pickup_longitude pickup_latitude
##       &lt;int&gt;           &lt;int&gt;         &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
## 1         1               1          1.30        -73.94249        40.79044
## 2         1               1          4.70        -73.93792        40.81836
## 3         2               1          4.42        -73.93603        40.80380
## 4         2               1          5.89        -73.93388        40.80276
## 5         1               1          4.10        -73.94268        40.81198
## 6         2               3          3.20        -73.95286        40.78902
## 7         1               2          1.40        -73.93806        40.80351
## 8         1               2          1.10        -73.95318        40.79869
## 9         2               1          0.32        -73.95840        40.80272
## 10        2               1          1.81        -73.94090        40.80830
## # ... with 71,969 more rows, and 16 more variables: RatecodeID &lt;int&gt;,
## #   store_and_fwd_flag &lt;chr&gt;, dropoff_longitude &lt;dbl&gt;,
## #   dropoff_latitude &lt;dbl&gt;, payment_type &lt;int&gt;, fare_amount &lt;dbl&gt;,
## #   tip_amount &lt;dbl&gt;, tolls_amount &lt;dbl&gt;, tip_percent &lt;dbl&gt;,
## #   pickup_hour &lt;fctr&gt;, pickup_dow &lt;fctr&gt;, dropoff_hour &lt;fctr&gt;,
## #   dropoff_dow &lt;fctr&gt;, trip_duration &lt;int&gt;, pickup_nhood &lt;fctr&gt;,
## #   dropoff_nhood &lt;fctr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># uncomment the line below (ctrl+shift+c) and filter harlem_pickups on Financial District</span>
<span class="co"># how many rows?</span>
<span class="co"># fidi &lt;- filter(harlem_pickups, ...)</span></code></pre></div>
</section><section id="select-a-set-of-columns" class="slide level2">
<h1>Select a set of columns</h1>
<ul>
<li class="fragment">You can use the <code>select()</code> verb to specify which columns of a dataset you want</li>
<li class="fragment">This is similar to the <code>keep</code> option in SAS’s data step.</li>
<li class="fragment">Use a colon <code>:</code> to select all the columns between two variables (inclusive)</li>
<li class="fragment">Use <code>contains</code> to take any columns containing a certain word/phrase/character</li>
</ul>
</section><section id="select-example" class="slide level2">
<h1>Select Example</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(taxi_df, pickup_nhood, dropoff_nhood, 
       fare_amount, dropoff_hour, trip_distance)</code></pre></div>
<pre><code>## # A tibble: 5,000,000 × 5
##       pickup_nhood      dropoff_nhood fare_amount dropoff_hour
##             &lt;fctr&gt;             &lt;fctr&gt;       &lt;dbl&gt;       &lt;fctr&gt;
## 1             SoHo       Battery Park         7.0     6PM-10PM
## 2     East Village Bedford Stuyvesant        18.0     6PM-10PM
## 3          Midtown           Downtown        34.0     10PM-1AM
## 4  Upper East Side        Murray Hill         9.0     12PM-4PM
## 5     Little Italy          Chinatown         4.5     6PM-10PM
## 6  Upper East Side  Greenwich Village        15.5     10PM-1AM
## 7             NoHo       West Village        10.0      1AM-5AM
## 8  Upper East Side    Upper West Side        13.0     12PM-4PM
## 9  Upper East Side        East Harlem         8.5     12PM-4PM
## 10 Upper West Side            Midtown         9.0      4PM-6PM
## # ... with 4,999,990 more rows, and 1 more variables: trip_distance &lt;dbl&gt;</code></pre>
</section><section id="select-other-options" class="slide level2">
<h1>Select: Other Options</h1>
<dl>
<dt class="fragment">starts_with(x, ignore.case = FALSE)</dt>
<dd class="fragment"><p>name starts with <code>x</code></p>
</dd>
<dt class="fragment">ends_with(x, ignore.case = FALSE)</dt>
<dd class="fragment"><p>name ends with <code>x</code></p>
</dd>
<dt class="fragment">matches(x, ignore.case = FALSE)</dt>
<dd class="fragment"><p>selects all variables whose name matches the regular expression <code>x</code></p>
</dd>
<dt class="fragment">num_range(“V”, 1:5, width = 1)</dt>
<dd class="fragment"><p>selects all variables (numerically) from <code>V1</code> to <code>V5</code>.</p>
</dd>
</dl>
<ul>
<li class="fragment">You can also use a <code>-</code> to drop variables.</li>
</ul>
</section><section id="reordering-data" class="slide level2">
<h1>Reordering Data</h1>
<ul>
<li class="fragment">You can reorder your dataset based on conditions using the <code>arrange()</code> verb</li>
<li class="fragment">Use the <code>desc</code> function to sort in descending order rather than ascending order (default)</li>
</ul>
</section><section id="arrange" class="slide level2">
<h1>Arrange</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(<span class="kw">arrange</span>(taxi_df, <span class="kw">desc</span>(fare_amount), pickup_nhood), 
       fare_amount, pickup_nhood)</code></pre></div>
<pre><code>## # A tibble: 5,000,000 × 2
##    fare_amount                          pickup_nhood
##          &lt;dbl&gt;                                &lt;fctr&gt;
## 1      2020.37                         East New York
## 2       991.16                              Glendale
## 3       889.97                      Garment District
## 4       750.00                               Midwood
## 5       606.00                              Gramercy
## 6       600.00                            Tudor City
## 7       534.00                               Astoria
## 8       495.70                       Upper East Side
## 9       445.00 John F. Kennedy International Airport
## 10      420.00                       Upper East Side
## # ... with 4,999,990 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">select</span>(<span class="kw">arrange</span>(taxi_df, <span class="kw">desc</span>(fare_amount), pickup_nhood), 
       fare_amount, pickup_nhood), <span class="dv">10</span>)</code></pre></div>
<pre><code>## # A tibble: 10 × 2
##    fare_amount                          pickup_nhood
##          &lt;dbl&gt;                                &lt;fctr&gt;
## 1      2020.37                         East New York
## 2       991.16                              Glendale
## 3       889.97                      Garment District
## 4       750.00                               Midwood
## 5       606.00                              Gramercy
## 6       600.00                            Tudor City
## 7       534.00                               Astoria
## 8       495.70                       Upper East Side
## 9       445.00 John F. Kennedy International Airport
## 10      420.00                       Upper East Side</code></pre>
</section><section id="exercise-1" class="slide level2">
<h1>Exercise</h1>
<p>Use <code>arrange()</code> to sort on the basis of <code>tip_amount</code>, <code>dropoff_nhood</code>, and <code>pickup_dow</code>, with descending order for tip amount</p>
</section><section id="summary" class="slide level2">
<h1>Summary</h1>
<dl>
<dt class="fragment">filter</dt>
<dd class="fragment"><p>Extract subsets of rows. See also <code>slice()</code></p>
</dd>
<dt class="fragment">select</dt>
<dd class="fragment"><p>Extract subsets of columns. See also <code>rename()</code></p>
</dd>
<dt class="fragment">arrange</dt>
<dd class="fragment"><p>Sort your data</p>
</dd>
</dl>
</section></section>
<section><section id="data-aggregations-and-transformations" class="titleslide slide level1"><h1>Data Aggregations and Transformations</h1></section><section id="transformations" class="slide level2">
<h1>Transformations</h1>
<ul>
<li class="fragment">The <code>mutate()</code> verb can be used to make new columns</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxi_df &lt;-<span class="st"> </span><span class="kw">mutate</span>(taxi_df, <span class="dt">tip_pct =</span> tip_amount/fare_amount)
<span class="kw">select</span>(taxi_df, tip_pct, fare_amount, tip_amount)</code></pre></div>
<pre><code>## # A tibble: 5,000,000 × 3
##      tip_pct fare_amount tip_amount
##        &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
## 1  0.2928571         7.0       2.05
## 2  0.1388889        18.0       2.50
## 3  0.2076471        34.0       7.06
## 4  0.0000000         9.0       0.00
## 5  0.0000000         4.5       0.00
## 6  0.0000000        15.5       0.00
## 7  0.2260000        10.0       2.26
## 8  0.2276923        13.0       2.96
## 9  0.2188235         8.5       1.86
## 10 0.3000000         9.0       2.70
## # ... with 4,999,990 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">transmute</span>(taxi_df, <span class="dt">tip_pct =</span> tip_amount/fare_amount)</code></pre></div>
<pre><code>## # A tibble: 5,000,000 × 1
##      tip_pct
##        &lt;dbl&gt;
## 1  0.2928571
## 2  0.1388889
## 3  0.2076471
## 4  0.0000000
## 5  0.0000000
## 6  0.0000000
## 7  0.2260000
## 8  0.2276923
## 9  0.2188235
## 10 0.3000000
## # ... with 4,999,990 more rows</code></pre>
</section><section id="summarise-data-by-groups" class="slide level2">
<h1>Summarise Data by Groups</h1>
<ul>
<li class="fragment">The <code>group_by</code> verb creates a grouping by a categorical variable</li>
<li class="fragment">Functions can be placed inside <code>summarise</code> to create summary functions</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grouped_taxi &lt;-<span class="st"> </span><span class="kw">group_by</span>(taxi_df, dropoff_nhood)
<span class="kw">class</span>(grouped_taxi)</code></pre></div>
<pre><code>## [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grouped_taxi</code></pre></div>
<pre><code>## Source: local data frame [5,000,000 x 22]
## Groups: dropoff_nhood [260]
## 
##    VendorID passenger_count trip_distance pickup_longitude pickup_latitude
##       &lt;int&gt;           &lt;int&gt;         &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;
## 1         1               1          1.40        -74.00555        40.72562
## 2         2               2          4.58        -73.98419        40.73022
## 3         2               5          9.63        -73.97183        40.76273
## 4         1               1          1.70        -73.96131        40.77190
## 5         1               2          0.60        -73.99568        40.72430
## 6         1               1          4.10        -73.95731        40.76214
## 7         2               5          1.76        -73.99208        40.72919
## 8         2               1          2.68        -73.95257        40.78289
## 9         2               1          1.69        -73.94909        40.78134
## 10        2               1          1.16        -73.98251        40.76832
## # ... with 4,999,990 more rows, and 17 more variables: RatecodeID &lt;int&gt;,
## #   store_and_fwd_flag &lt;chr&gt;, dropoff_longitude &lt;dbl&gt;,
## #   dropoff_latitude &lt;dbl&gt;, payment_type &lt;int&gt;, fare_amount &lt;dbl&gt;,
## #   tip_amount &lt;dbl&gt;, tolls_amount &lt;dbl&gt;, tip_percent &lt;dbl&gt;,
## #   pickup_hour &lt;fctr&gt;, pickup_dow &lt;fctr&gt;, dropoff_hour &lt;fctr&gt;,
## #   dropoff_dow &lt;fctr&gt;, trip_duration &lt;int&gt;, pickup_nhood &lt;fctr&gt;,
## #   dropoff_nhood &lt;fctr&gt;, tip_pct &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize</span>(<span class="kw">group_by</span>(taxi_df, dropoff_nhood), 
          <span class="dt">Num =</span> <span class="kw">n</span>(), <span class="dt">ave_tip_pct =</span> <span class="kw">mean</span>(tip_pct))</code></pre></div>
<pre><code>## # A tibble: 260 × 3
##      dropoff_nhood   Num ave_tip_pct
##             &lt;fctr&gt; &lt;int&gt;       &lt;dbl&gt;
## 1         Annadale     5  0.24561406
## 2    Arden Heights    12  0.15648199
## 3         Arrochar    36  0.11437722
## 4          Arverne    69  0.11855379
## 5          Astoria 53770  0.16893957
## 6  Astoria Heights   594  0.08350706
## 7       Auburndale   390  0.09936931
## 8       Bath Beach   802  0.10006194
## 9     Battery Park 53613  0.20848133
## 10       Bay Ridge  2846  0.13369090
## # ... with 250 more rows</code></pre>
</section><section id="group-by-neighborhoods-example" class="slide level2">
<h1>Group By Neighborhoods Example</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(<span class="kw">group_by</span>(taxi_df, pickup_nhood, dropoff_nhood), 
          <span class="dt">Num =</span> <span class="kw">n</span>(), <span class="dt">ave_tip_pct =</span> <span class="kw">mean</span>(tip_pct))</code></pre></div>
<pre><code>## Source: local data frame [13,089 x 4]
## Groups: pickup_nhood [?]
## 
##    pickup_nhood   dropoff_nhood   Num ave_tip_pct
##          &lt;fctr&gt;          &lt;fctr&gt; &lt;int&gt;       &lt;dbl&gt;
## 1      Arrochar        Arrochar     1  0.00000000
## 2      Arrochar   Crown Heights     2  0.18914665
## 3       Arverne         Arverne     4  0.12575000
## 4       Arverne    Far Rockaway     2  0.00000000
## 5       Astoria         Astoria  9896  0.34644699
## 6       Astoria Astoria Heights   161  0.07155575
## 7       Astoria      Auburndale     4  0.05240741
## 8       Astoria      Bath Beach     1  0.00000000
## 9       Astoria    Battery Park    19  0.14814670
## 10      Astoria       Bay Ridge     8  0.09474953
## # ... with 13,079 more rows</code></pre>
</section><section id="chainingpiping" class="slide level2">
<h1>Chaining/Piping</h1>
<ul>
<li class="fragment">A <code>dplyr</code> installation includes the <code>magrittr</code> package as a dependency</li>
<li class="fragment">The <code>magrittr</code> package includes a pipe operator that allows you to pass the current dataset to another function</li>
<li class="fragment">This makes interpreting a nested sequence of operations much easier to understand</li>
</ul>
</section><section id="standard-code" class="slide level2">
<h1>Standard Code</h1>
<ul>
<li class="fragment">Code is executed inside-out.</li>
<li class="fragment">Let’s arrange the above average tips in descending order, and only look at the locations that had at least 10 dropoffs and pickups.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(<span class="kw">arrange</span>(<span class="kw">summarise</span>(<span class="kw">group_by</span>(taxi_df, pickup_nhood, dropoff_nhood), <span class="dt">Num =</span> <span class="kw">n</span>(), <span class="dt">ave_tip_pct =</span> <span class="kw">mean</span>(tip_pct)), <span class="kw">desc</span>(ave_tip_pct)), Num &gt;=<span class="st"> </span><span class="dv">10</span>)</code></pre></div>
<pre><code>## Source: local data frame [5,333 x 4]
## Groups: pickup_nhood [151]
## 
##          pickup_nhood                         dropoff_nhood   Num
##                &lt;fctr&gt;                                &lt;fctr&gt; &lt;int&gt;
## 1             Melrose                               Melrose    23
## 2        Central Park John F. Kennedy International Airport   548
## 3          Mott Haven                            Mott Haven   242
## 4  La Guardia Airport                    La Guardia Airport  1665
## 5        Battery Park                          Battery Park  1666
## 6      Pelham Gardens                        Pelham Gardens    13
## 7            Longwood                              Longwood    12
## 8    Garment District                        Brighton Beach    21
## 9        Far Rockaway                          Far Rockaway    16
## 10          Flatlands                             Flatlands    15
## # ... with 5,323 more rows, and 1 more variables: ave_tip_pct &lt;dbl&gt;</code></pre>
</section><section class="slide level2">

<p><img src="http://www.ohmagif.com/wp-content/uploads/2015/01/lemme-go-out-for-a-walk-oh-no-shit.gif" alt="damn" /></p>
</section><section id="reformatted" class="slide level2">
<h1>Reformatted</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(
  <span class="kw">arrange</span>(
    <span class="kw">summarise</span>(
      <span class="kw">group_by</span>(taxi_df, 
               pickup_nhood, dropoff_nhood), 
      <span class="dt">Num =</span> <span class="kw">n</span>(), 
      <span class="dt">ave_tip_pct =</span> <span class="kw">mean</span>(tip_pct)), 
    <span class="kw">desc</span>(ave_tip_pct)), 
  Num &gt;=<span class="st"> </span><span class="dv">10</span>)</code></pre></div>
<pre><code>## Source: local data frame [5,333 x 4]
## Groups: pickup_nhood [151]
## 
##          pickup_nhood                         dropoff_nhood   Num
##                &lt;fctr&gt;                                &lt;fctr&gt; &lt;int&gt;
## 1             Melrose                               Melrose    23
## 2        Central Park John F. Kennedy International Airport   548
## 3          Mott Haven                            Mott Haven   242
## 4  La Guardia Airport                    La Guardia Airport  1665
## 5        Battery Park                          Battery Park  1666
## 6      Pelham Gardens                        Pelham Gardens    13
## 7            Longwood                              Longwood    12
## 8    Garment District                        Brighton Beach    21
## 9        Far Rockaway                          Far Rockaway    16
## 10          Flatlands                             Flatlands    15
## # ... with 5,323 more rows, and 1 more variables: ave_tip_pct &lt;dbl&gt;</code></pre>
</section><section id="magrittr" class="slide level2">
<h1>Magrittr</h1>
<p><img src="https://github.com/smbache/magrittr/raw/master/inst/logo.png" /></p>
<ul>
<li class="fragment">Inspired by unix <code>|</code>, and F# forward pipe <code>|&gt;</code>, <code>magrittr</code> introduces the funny character (<code>%&gt;%</code>, the <em>then</em> operator)</li>
<li class="fragment"><code>%&gt;%</code> pipes the object on the left hand side to the first argument of the function on the right hand side</li>
<li class="fragment">Every function in <code>dplyr</code> has a slot for <code>data.frame/tbl</code> as it’s first argument, so this works beautifully!</li>
</ul>
</section><section id="put-that-function-in-your-pipe-and" class="slide level2">
<h1>Put that Function in Your Pipe and…</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxi_df %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(pickup_nhood, dropoff_nhood) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Num =</span> <span class="kw">n</span>(),
            <span class="dt">ave_tip_pct =</span> <span class="kw">mean</span>(tip_pct)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(ave_tip_pct)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Num &gt;=<span class="st"> </span><span class="dv">10</span>)</code></pre></div>
<pre><code>## Source: local data frame [5,333 x 4]
## Groups: pickup_nhood [151]
## 
##          pickup_nhood                         dropoff_nhood   Num
##                &lt;fctr&gt;                                &lt;fctr&gt; &lt;int&gt;
## 1             Melrose                               Melrose    23
## 2        Central Park John F. Kennedy International Airport   548
## 3          Mott Haven                            Mott Haven   242
## 4  La Guardia Airport                    La Guardia Airport  1665
## 5        Battery Park                          Battery Park  1666
## 6      Pelham Gardens                        Pelham Gardens    13
## 7            Longwood                              Longwood    12
## 8    Garment District                        Brighton Beach    21
## 9        Far Rockaway                          Far Rockaway    16
## 10          Flatlands                             Flatlands    15
## # ... with 5,323 more rows, and 1 more variables: ave_tip_pct &lt;dbl&gt;</code></pre>
</section><section class="slide level2">

<p><img src="http://i.giphy.com/lF1XZv45kIwMw.gif" alt="hellyeah" /></p>
</section><section id="pipe-group_by" class="slide level2">
<h1>Pipe + group_by()</h1>
<ul>
<li class="fragment">The pipe operator is very helpful for group by summaries</li>
<li class="fragment">Let’s calculate average tip amount, and average trip distance, controlling for dropoff day of the week and dropoff location</li>
<li class="fragment">First filter with the vector <code>manhattan_hoods</code></li>
</ul>
</section><section class="slide level2">

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mht_url &lt;-<span class="st"> &quot;http://alizaidi.blob.core.windows.net/training/manhattan.rds&quot;</span>
manhattan_hoods &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">gzcon</span>(<span class="kw">url</span>(mht_url)))
taxi_df %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(pickup_nhood %in%<span class="st"> </span>manhattan_hoods,
         dropoff_nhood %in%<span class="st"> </span>manhattan_hoods) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(dropoff_nhood, pickup_nhood) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">ave_tip =</span> <span class="kw">mean</span>(tip_pct), 
            <span class="dt">ave_dist =</span> <span class="kw">mean</span>(trip_distance)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(ave_dist &gt;<span class="st"> </span><span class="dv">3</span>, ave_tip &gt;<span class="st"> </span><span class="fl">0.05</span>)</code></pre></div>
<pre><code>## Source: local data frame [325 x 4]
## Groups: dropoff_nhood [24]
## 
##    dropoff_nhood        pickup_nhood   ave_tip ave_dist
##           &lt;fctr&gt;              &lt;fctr&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1   Battery Park        Central Park 0.1176756 6.173279
## 2   Battery Park             Clinton 0.1172045 3.989862
## 3   Battery Park         East Harlem 0.1774509 8.880230
## 4   Battery Park        East Village 0.1418621 3.556687
## 5   Battery Park    Garment District 0.1194719 4.041875
## 6   Battery Park            Gramercy 0.1453468 4.743278
## 7   Battery Park    Hamilton Heights 0.1386226 9.067857
## 8   Battery Park              Harlem 0.1356608 8.968276
## 9   Battery Park             Midtown 0.1166259 5.423574
## 10  Battery Park Morningside Heights 0.1344809 8.083016
## # ... with 315 more rows</code></pre>
</section><section id="pipe-and-plot" class="slide level2">
<h1>Pipe and Plot</h1>
<p>Piping is not limited to dplyr functions, can be used everywhere!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
taxi_df %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(pickup_nhood %in%<span class="st"> </span>manhattan_hoods,
         dropoff_nhood %in%<span class="st"> </span>manhattan_hoods) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(dropoff_nhood, pickup_nhood) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">ave_tip =</span> <span class="kw">mean</span>(tip_pct), 
            <span class="dt">ave_dist =</span> <span class="kw">mean</span>(trip_distance)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(ave_dist &gt;<span class="st"> </span><span class="dv">3</span>, ave_tip &gt;<span class="st"> </span><span class="fl">0.05</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> pickup_nhood, <span class="dt">y =</span> dropoff_nhood)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> ave_tip), <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme_bw</span>() +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>),
          <span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>) +
<span class="st">    </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;steelblue&quot;</span>)</code></pre></div>
</section><section class="slide level2">

<p><img src="1-intro-to-R_files/figure-revealjs/unnamed-chunk-15-1.png" width="768" style="display: block; margin: auto;" /></p>
</section><section id="piping-to-other-arguments" class="slide level2">
<h1>Piping to other arguments</h1>
<ul>
<li class="fragment">Although <code>dplyr</code> takes great care to make it particularly amenable to piping, other functions may not reserve the first argument to the object you are passing into it.</li>
<li class="fragment">You can use the special <code>.</code> placeholder to specify where the object should enter</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxi_df %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(pickup_nhood %in%<span class="st"> </span>manhattan_hoods,
         dropoff_nhood %in%<span class="st"> </span>manhattan_hoods) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(dropoff_nhood, pickup_nhood) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">ave_tip =</span> <span class="kw">mean</span>(tip_pct), 
            <span class="dt">ave_dist =</span> <span class="kw">mean</span>(trip_distance)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">lm</span>(ave_tip ~<span class="st"> </span>ave_dist, <span class="dt">data =</span> .) -&gt;<span class="st"> </span>taxi_model
<span class="kw">summary</span>(taxi_model)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ave_tip ~ ave_dist, data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.12962 -0.01573 -0.00397  0.00826  2.10714 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.147818   0.006793   21.76  &lt; 2e-16 ***
## ave_dist    -0.003279   0.001247   -2.63  0.00878 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.0927 on 571 degrees of freedom
## Multiple R-squared:  0.01197,    Adjusted R-squared:  0.01024 
## F-statistic: 6.915 on 1 and 571 DF,  p-value: 0.008776</code></pre>
</section><section id="exercise-2" class="slide level2">
<h1>Exercise</h1>
<p>Your turn:</p>
<ul>
<li class="fragment">Use the pipe operator to group by day of week and dropoff neighborhood</li>
<li class="fragment">Filter to Manhattan neighborhoods</li>
<li class="fragment">Make tile plot with average fare amount in dollars as the fill</li>
</ul>
</section></section>
<section><section id="functional-programming" class="titleslide slide level1"><h1>Functional Programming</h1></section><section id="creating-functional-pipelines" class="slide level2">
<h1>Creating Functional Pipelines</h1>
<h3 id="too-many-pipes">Too Many Pipes?</h3>
<p><img src="http://www.ohmagif.com/wp-content/uploads/2015/02/the-scariest-electrical-repair-ever.gif" alt="whoaaaaaaaaahhhhh" /></p>
</section><section class="slide level2">

<h3 id="reusable-code">Reusable code</h3>
<ul>
<li class="fragment">The examples above create a rather messy pipeline operation</li>
<li class="fragment">Can be very hard to debug</li>
<li class="fragment">The operation is pretty readable, but lacks reusability</li>
<li class="fragment">Since R is a functional language, we benefit by splitting these operations into functions and calling them separately</li>
<li class="fragment">This allows resuability; don’t write the same code twice!</li>
</ul>
</section><section id="functional-pipelines" class="slide level2">
<h1>Functional Pipelines</h1>
<h3 id="summarization">Summarization</h3>
<ul>
<li class="fragment">Let’s create a function that takes an argument for the data, and applies the summarization by neighborhood to calculate average tip and trip distance</li>
</ul>
</section><section class="slide level2">

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxi_hood_sum &lt;-<span class="st"> </span>function(<span class="dt">taxi_data =</span> taxi_df) {
  
  mht_url &lt;-<span class="st"> &quot;http://alizaidi.blob.core.windows.net/training/manhattan.rds&quot;</span>
  
  manhattan_hoods &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">gzcon</span>(<span class="kw">url</span>(mht_url)))
  taxi_data %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(pickup_nhood %in%<span class="st"> </span>manhattan_hoods,
           dropoff_nhood %in%<span class="st"> </span>manhattan_hoods) %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(dropoff_nhood, pickup_nhood) %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">summarize</span>(<span class="dt">ave_tip =</span> <span class="kw">mean</span>(tip_pct), 
              <span class="dt">ave_dist =</span> <span class="kw">mean</span>(trip_distance)) %&gt;%<span class="st"> </span>
<span class="st">    </span><span class="kw">filter</span>(ave_dist &gt;<span class="st"> </span><span class="dv">3</span>, ave_tip &gt;<span class="st"> </span><span class="fl">0.05</span>) -&gt;<span class="st"> </span>sum_df
  
  <span class="kw">return</span>(sum_df)
  
}</code></pre></div>
</section><section id="functional-pipelines-1" class="slide level2">
<h1>Functional Pipelines</h1>
<h3 id="plotting-function">Plotting Function</h3>
<ul>
<li class="fragment">We can create a second function for the plot</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tile_plot_hood &lt;-<span class="st"> </span>function(<span class="dt">df =</span> <span class="kw">taxi_hood_sum</span>()) {
  
  <span class="kw">library</span>(ggplot2)
  
  <span class="kw">ggplot</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> pickup_nhood, <span class="dt">y =</span> dropoff_nhood)) +<span class="st"> </span>
<span class="st">    </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> ave_tip), <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>) +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme_bw</span>() +<span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>),
          <span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>) +
<span class="st">    </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;steelblue&quot;</span>) -&gt;<span class="st"> </span>gplot
  
  <span class="kw">return</span>(gplot)
}</code></pre></div>
</section><section id="calling-our-pipeline" class="slide level2">
<h1>Calling Our Pipeline</h1>
<ul>
<li class="fragment">Now we can create our plot by simply calling our two functions</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plotly)
<span class="kw">taxi_hood_sum</span>(taxi_df) %&gt;%<span class="st"> </span>tile_plot_hood %&gt;%<span class="st"> </span>ggplotly</code></pre></div>
<p>Let’s make that baby interactive.</p>
</section><section id="creating-complex-pipelines-with-do" class="slide level2">
<h1>Creating Complex Pipelines with do</h1>
<ul>
<li class="fragment">The <code>summarize</code> function is fun, can summarize many numeric/scalar quantities</li>
<li class="fragment">But what if you want multiple values/rows back, not just a scalar summary?</li>
<li class="fragment">Meet the <code>do</code> verb – arbitrary <code>tbl</code> operations</li>
</ul>
</section><section class="slide level2">

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxi_df %&gt;%<span class="st"> </span><span class="kw">group_by</span>(dropoff_dow) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(!<span class="kw">is.na</span>(dropoff_nhood), !<span class="kw">is.na</span>(pickup_nhood)) %&gt;%
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(tip_pct)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">slice</span>(., <span class="dv">1</span>:<span class="dv">2</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(dropoff_dow, tip_amount, tip_pct, 
         fare_amount, dropoff_nhood, pickup_nhood)</code></pre></div>
<pre><code>## Source: local data frame [14 x 6]
## Groups: dropoff_dow [7]
## 
##    dropoff_dow tip_amount  tip_pct fare_amount
##         &lt;fctr&gt;      &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
## 1          Sun       4.60  460.000        0.01
## 2          Sun      80.70   32.280        2.50
## 3          Mon      62.00 6200.000        0.01
## 4          Mon      38.00 3800.000        0.01
## 5          Tue      35.00 3500.000        0.01
## 6          Tue      21.00 2100.000        0.01
## 7          Wed      49.69 4969.000        0.01
## 8          Wed     100.00   40.000        2.50
## 9          Thu      10.80 1080.000        0.01
## 10         Thu     655.58   65.558       10.00
## 11         Fri      53.61 5361.000        0.01
## 12         Fri      22.00 2200.000        0.01
## 13         Sat      20.00 2000.000        0.01
## 14         Sat      10.00 1000.000        0.01
## # ... with 2 more variables: dropoff_nhood &lt;fctr&gt;, pickup_nhood &lt;fctr&gt;</code></pre>
</section><section id="estimating-multiple-models-with-do" class="slide level2">
<h1>Estimating Multiple Models with do</h1>
<ul>
<li class="fragment">A common use of <code>do</code> is to calculate many different models by a grouping variable</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dow_lms &lt;-<span class="st"> </span>taxi_df %&gt;%<span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>^<span class="dv">4</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(dropoff_dow) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">do</span>(<span class="dt">lm_tip =</span> <span class="kw">lm</span>(tip_pct ~<span class="st"> </span>pickup_nhood +<span class="st"> </span>passenger_count +<span class="st"> </span>pickup_hour,
     <span class="dt">data =</span> .))</code></pre></div>
</section><section class="slide level2">

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dow_lms</code></pre></div>
<pre><code>## Source: local data frame [7 x 2]
## Groups: &lt;by row&gt;
## 
## # A tibble: 7 × 2
##   dropoff_dow   lm_tip
## *      &lt;fctr&gt;   &lt;list&gt;
## 1         Sun &lt;S3: lm&gt;
## 2         Mon &lt;S3: lm&gt;
## 3         Tue &lt;S3: lm&gt;
## 4         Wed &lt;S3: lm&gt;
## 5         Thu &lt;S3: lm&gt;
## 6         Fri &lt;S3: lm&gt;
## 7         Sat &lt;S3: lm&gt;</code></pre>
<p>Where are our results? <img src="http://i.giphy.com/oEnTTI3ZdK6ic.gif" alt="digging" /></p>
</section><section id="cleaning-output" class="slide level2">
<h1>Cleaning Output</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(dow_lms$lm_tip[[<span class="dv">1</span>]])</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = tip_pct ~ pickup_nhood + passenger_count + pickup_hour, 
##     data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.38318 -0.11700  0.01093  0.09271  2.38318 
## 
## Coefficients:
##                                                    Estimate Std. Error
## (Intercept)                                        0.097867   0.045502
## pickup_nhoodBattery Park                           0.068485   0.061761
## pickup_nhoodBedford Stuyvesant                     0.020767   0.103992
## pickup_nhoodBoerum Hill                           -0.095178   0.168641
## pickup_nhoodBrooklyn Heights                       0.018656   0.103751
## pickup_nhoodBushwick                               0.109012   0.124009
## pickup_nhoodCarnegie Hill                          0.047046   0.064253
## pickup_nhoodCarroll Gardens                        0.074175   0.103758
## pickup_nhoodCentral Park                           0.048001   0.062886
## pickup_nhoodChelsea                                0.069769   0.047100
## pickup_nhoodChinatown                             -0.080395   0.103714
## pickup_nhoodClinton                               -0.004197   0.048940
## pickup_nhoodClinton Hill                           0.172629   0.123488
## pickup_nhoodColumbia Street Waterfront District   -0.070452   0.168736
## pickup_nhoodColumbus Circle                        0.072323   0.058865
## pickup_nhoodCrown Heights                          0.110186   0.168937
## pickup_nhoodDowntown                               2.312732   0.123197
## pickup_nhoodEast Elmhurst                         -0.090852   0.168845
## pickup_nhoodEast Harlem                            0.020722   0.058087
## pickup_nhoodEast Village                           0.044181   0.048662
## pickup_nhoodElmhurst                               0.164822   0.168641
## pickup_nhoodFinancial District                     0.068577   0.058052
## pickup_nhoodFlatiron District                      0.057561   0.047572
## pickup_nhoodFort Greene                           -0.097069   0.168762
## pickup_nhoodGarment District                       0.017056   0.048029
## pickup_nhoodGowanus                                0.035926   0.123407
## pickup_nhoodGramercy                               0.055760   0.049125
## pickup_nhoodGreenpoint                             0.020143   0.123178
## pickup_nhoodGreenwich Village                      0.036255   0.048206
## pickup_nhoodHamilton Heights                       0.093565   0.123197
## pickup_nhoodHarlem                                 0.030657   0.079712
## pickup_nhoodHunters Point                         -0.020143   0.168655
## pickup_nhoodJackson Heights                       -0.070452   0.168736
## pickup_nhoodJamaica Estates                       -0.094359   0.168805
## pickup_nhoodJohn F. Kennedy International Airport  0.042741   0.050204
## pickup_nhoodLa Guardia Airport                     0.041151   0.053624
## pickup_nhoodLittle Italy                           0.035596   0.057396
## pickup_nhoodLongwood                              -0.095178   0.168641
## pickup_nhoodLower East Side                        0.069724   0.050162
## pickup_nhoodManhattanville                        -0.095714   0.123222
## pickup_nhoodMaspeth                                0.280501   0.169261
## pickup_nhoodMidtown                                0.023903   0.046265
## pickup_nhoodMorningside Heights                    0.069168   0.075423
## pickup_nhoodMurray Hill                            0.008241   0.053729
## pickup_nhoodNoHo                                   0.063105   0.056384
## pickup_nhoodPark Slope                            -0.091671   0.168650
## pickup_nhoodProspect Heights                       0.148155   0.168641
## pickup_nhoodProspect Lefferts Gardens             -0.100577   0.168666
## pickup_nhoodRed Hook                              -0.095178   0.168641
## pickup_nhoodSoHo                                   0.032178   0.053507
## pickup_nhoodStuyvesant Town                        0.178059   0.103670
## pickup_nhoodSunnyside                             -0.021794   0.085021
## pickup_nhoodSutton Place                           0.022966   0.056951
## pickup_nhoodTribeca                                0.050114   0.058288
## pickup_nhoodTudor City                             0.067291   0.067488
## pickup_nhoodTurtle Bay                             0.062725   0.051865
## pickup_nhoodUpper East Side                        0.043261   0.045616
## pickup_nhoodUpper West Side                        0.048332   0.046457
## pickup_nhoodWashington Heights                    -0.008674   0.103803
## pickup_nhoodWest Village                           0.096652   0.052833
## pickup_nhoodWilliamsburg                           0.001506   0.065681
## pickup_nhoodWindsor Terrace                       -0.094359   0.168805
## pickup_nhoodWoodside                               0.197969   0.168736
## passenger_count                                   -0.003508   0.003472
## pickup_hour5AM-9AM                                -0.012726   0.021028
## pickup_hour9AM-12PM                               -0.023907   0.018149
## pickup_hour12PM-4PM                               -0.013611   0.017796
## pickup_hour4PM-6PM                                -0.001527   0.019540
## pickup_hour6PM-10PM                                0.009725   0.017523
## pickup_hour10PM-1AM                                0.000819   0.017655
##                                                   t value Pr(&gt;|t|)    
## (Intercept)                                         2.151   0.0317 *  
## pickup_nhoodBattery Park                            1.109   0.2677    
## pickup_nhoodBedford Stuyvesant                      0.200   0.8417    
## pickup_nhoodBoerum Hill                            -0.564   0.5726    
## pickup_nhoodBrooklyn Heights                        0.180   0.8573    
## pickup_nhoodBushwick                                0.879   0.3795    
## pickup_nhoodCarnegie Hill                           0.732   0.4642    
## pickup_nhoodCarroll Gardens                         0.715   0.4748    
## pickup_nhoodCentral Park                            0.763   0.4454    
## pickup_nhoodChelsea                                 1.481   0.1388    
## pickup_nhoodChinatown                              -0.775   0.4384    
## pickup_nhoodClinton                                -0.086   0.9317    
## pickup_nhoodClinton Hill                            1.398   0.1624    
## pickup_nhoodColumbia Street Waterfront District    -0.418   0.6764    
## pickup_nhoodColumbus Circle                         1.229   0.2194    
## pickup_nhoodCrown Heights                           0.652   0.5144    
## pickup_nhoodDowntown                               18.773   &lt;2e-16 ***
## pickup_nhoodEast Elmhurst                          -0.538   0.5906    
## pickup_nhoodEast Harlem                             0.357   0.7213    
## pickup_nhoodEast Village                            0.908   0.3641    
## pickup_nhoodElmhurst                                0.977   0.3286    
## pickup_nhoodFinancial District                      1.181   0.2377    
## pickup_nhoodFlatiron District                       1.210   0.2265    
## pickup_nhoodFort Greene                            -0.575   0.5653    
## pickup_nhoodGarment District                        0.355   0.7225    
## pickup_nhoodGowanus                                 0.291   0.7710    
## pickup_nhoodGramercy                                1.135   0.2566    
## pickup_nhoodGreenpoint                              0.164   0.8701    
## pickup_nhoodGreenwich Village                       0.752   0.4521    
## pickup_nhoodHamilton Heights                        0.759   0.4477    
## pickup_nhoodHarlem                                  0.385   0.7006    
## pickup_nhoodHunters Point                          -0.119   0.9050    
## pickup_nhoodJackson Heights                        -0.418   0.6764    
## pickup_nhoodJamaica Estates                        -0.559   0.5763    
## pickup_nhoodJohn F. Kennedy International Airport   0.851   0.3947    
## pickup_nhoodLa Guardia Airport                      0.767   0.4430    
## pickup_nhoodLittle Italy                            0.620   0.5353    
## pickup_nhoodLongwood                               -0.564   0.5726    
## pickup_nhoodLower East Side                         1.390   0.1648    
## pickup_nhoodManhattanville                         -0.777   0.4374    
## pickup_nhoodMaspeth                                 1.657   0.0977 .  
## pickup_nhoodMidtown                                 0.517   0.6055    
## pickup_nhoodMorningside Heights                     0.917   0.3593    
## pickup_nhoodMurray Hill                             0.153   0.8781    
## pickup_nhoodNoHo                                    1.119   0.2633    
## pickup_nhoodPark Slope                             -0.544   0.5868    
## pickup_nhoodProspect Heights                        0.879   0.3798    
## pickup_nhoodProspect Lefferts Gardens              -0.596   0.5511    
## pickup_nhoodRed Hook                               -0.564   0.5726    
## pickup_nhoodSoHo                                    0.601   0.5477    
## pickup_nhoodStuyvesant Town                         1.718   0.0861 .  
## pickup_nhoodSunnyside                              -0.256   0.7977    
## pickup_nhoodSutton Place                            0.403   0.6868    
## pickup_nhoodTribeca                                 0.860   0.3901    
## pickup_nhoodTudor City                              0.997   0.3189    
## pickup_nhoodTurtle Bay                              1.209   0.2267    
## pickup_nhoodUpper East Side                         0.948   0.3431    
## pickup_nhoodUpper West Side                         1.040   0.2984    
## pickup_nhoodWashington Heights                     -0.084   0.9334    
## pickup_nhoodWest Village                            1.829   0.0676 .  
## pickup_nhoodWilliamsburg                            0.023   0.9817    
## pickup_nhoodWindsor Terrace                        -0.559   0.5763    
## pickup_nhoodWoodside                                1.173   0.2409    
## passenger_count                                    -1.010   0.3126    
## pickup_hour5AM-9AM                                 -0.605   0.5452    
## pickup_hour9AM-12PM                                -1.317   0.1880    
## pickup_hour12PM-4PM                                -0.765   0.4445    
## pickup_hour4PM-6PM                                 -0.078   0.9377    
## pickup_hour6PM-10PM                                 0.555   0.5790    
## pickup_hour10PM-1AM                                 0.046   0.9630    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1626 on 1268 degrees of freedom
## Multiple R-squared:  0.2574, Adjusted R-squared:  0.217 
## F-statistic: 6.369 on 69 and 1268 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)
dow_lms %&gt;%<span class="st"> </span><span class="kw">tidy</span>(lm_tip)</code></pre></div>
<pre><code>## Source: local data frame [440 x 6]
## Groups: dropoff_dow [7]
## 
##    dropoff_dow                           term    estimate  std.error
##         &lt;fctr&gt;                          &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
## 1          Sun                    (Intercept)  0.09786717 0.04550147
## 2          Sun       pickup_nhoodBattery Park  0.06848530 0.06176153
## 3          Sun pickup_nhoodBedford Stuyvesant  0.02076703 0.10399217
## 4          Sun        pickup_nhoodBoerum Hill -0.09517851 0.16864112
## 5          Sun   pickup_nhoodBrooklyn Heights  0.01865640 0.10375084
## 6          Sun           pickup_nhoodBushwick  0.10901180 0.12400928
## 7          Sun      pickup_nhoodCarnegie Hill  0.04704615 0.06425285
## 8          Sun    pickup_nhoodCarroll Gardens  0.07417470 0.10375796
## 9          Sun       pickup_nhoodCentral Park  0.04800133 0.06288641
## 10         Sun            pickup_nhoodChelsea  0.06976916 0.04709954
## # ... with 430 more rows, and 2 more variables: statistic &lt;dbl&gt;,
## #   p.value &lt;dbl&gt;</code></pre>
<ul>
<li class="fragment">By design, every function in <code>dplyr</code> returns a <code>data.frame</code></li>
<li class="fragment">In the example above, we get back a spooky <code>data.frame</code> with a column of <code>S3</code> <code>lm</code> objects</li>
<li class="fragment">You can still modify each element as you would normally, or pass it to a <code>mutate</code> function to extract intercept or statistics</li>
<li class="fragment">But there’s also a very handy <code>broom</code> package for cleaning up such objects into <code>data.frames</code></li>
</ul>
</section><section id="brooming-up-the-mess" class="slide level2">
<h1>Brooming Up the Mess</h1>
<h3 id="model-metrics">Model Metrics</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)
taxi_df %&gt;%<span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>^<span class="dv">5</span>) %&gt;%<span class="st">  </span>
<span class="st">  </span><span class="kw">group_by</span>(dropoff_dow) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">glance</span>(<span class="kw">lm</span>(tip_pct ~<span class="st"> </span>pickup_nhood +<span class="st"> </span>passenger_count +<span class="st"> </span>pickup_hour,
     <span class="dt">data =</span> .)))</code></pre></div>
<pre><code>## Source: local data frame [7 x 12]
## Groups: dropoff_dow [7]
## 
##   dropoff_dow   r.squared adj.r.squared     sigma statistic      p.value
##        &lt;fctr&gt;       &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
## 1         Sun 0.009929894  0.0022771783 0.2513585 1.2975647 2.279059e-02
## 2         Mon 0.031695031  0.0246904662 0.1365088 4.5249107 7.017475e-42
## 3         Tue 0.018186271  0.0119403662 0.1827718 2.9117110 4.041650e-18
## 4         Wed 0.025359182  0.0187215999 0.1234986 3.8205453 2.384147e-33
## 5         Thu 0.005899222 -0.0002269261 0.3536197 0.9629578 5.811217e-01
## 6         Fri 0.018950778  0.0121548890 0.1217199 2.7885650 4.669893e-19
## 7         Sat 0.021114101  0.0149665394 0.1242509 3.4345490 9.712228e-27
## # ... with 6 more variables: df &lt;int&gt;, logLik &lt;dbl&gt;, AIC &lt;dbl&gt;, BIC &lt;dbl&gt;,
## #   deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<h3 id="model-coefficients">Model Coefficients</h3>
<p>The most commonly used function in the <code>broom</code> package is the <code>tidy</code> function. This will expand our data.frame and give us the model coefficients</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxi_df %&gt;%<span class="st"> </span><span class="kw">sample_n</span>(<span class="dv">10</span>^<span class="dv">5</span>) %&gt;%<span class="st">  </span>
<span class="st">  </span><span class="kw">group_by</span>(dropoff_dow) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(tip_pct ~<span class="st"> </span>pickup_nhood +<span class="st"> </span>passenger_count +<span class="st"> </span>pickup_hour,
     <span class="dt">data =</span> .)))</code></pre></div>
<pre><code>## Source: local data frame [679 x 6]
## Groups: dropoff_dow [7]
## 
##    dropoff_dow                           term    estimate  std.error
##         &lt;fctr&gt;                          &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;
## 1          Sun                    (Intercept)  0.06917512 0.02590300
## 2          Sun       pickup_nhoodBattery Park  0.06047232 0.03351828
## 3          Sun pickup_nhoodBedford Stuyvesant  0.07412049 0.05935296
## 4          Sun         pickup_nhoodBlissville -0.06432979 0.21598642
## 5          Sun        pickup_nhoodBoerum Hill  0.07669869 0.07245135
## 6          Sun          pickup_nhoodBriarwood  0.10126328 0.11021075
## 7          Sun   pickup_nhoodBrooklyn Heights  0.01993671 0.05661751
## 8          Sun           pickup_nhoodBushwick  0.01246053 0.06694339
## 9          Sun      pickup_nhoodCarnegie Hill  0.05221887 0.03281742
## 10         Sun    pickup_nhoodCarroll Gardens  0.03492579 0.07244414
## # ... with 669 more rows, and 2 more variables: statistic &lt;dbl&gt;,
## #   p.value &lt;dbl&gt;</code></pre>
</section><section id="spatial-visualizations-with-ggplot2-and-purrr" class="slide level2">
<h1>Spatial Visualizations with <code>ggplot2</code> and <code>purrr</code></h1>
<h3 id="visualizing-pickups-by-time">Visualizing Pickups by Time</h3>
<ul>
<li class="fragment">Let’s try another example</li>
<li class="fragment">We will visualize pickups and index them by time</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># min and max coordinates:</span>
min_lat &lt;-<span class="st"> </span><span class="fl">40.5774</span>
max_lat &lt;-<span class="st"> </span><span class="fl">40.9176</span>
min_long &lt;-<span class="st"> </span>-<span class="fl">74.15</span>
max_long &lt;-<span class="st"> </span>-<span class="fl">73.7004</span>

pickups &lt;-<span class="st"> </span>taxi_df %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(pickup_longitude &gt;<span class="st"> </span>min_long,
         pickup_latitude &lt;<span class="st"> </span>max_lat,
         dropoff_longitude &gt;<span class="st"> </span>min_long,
         dropoff_latitude &lt;<span class="st"> </span>max_lat) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(pickup_hour, 
           pickup_longitude, 
           pickup_latitude) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">num_pickups =</span> <span class="kw">n</span>())</code></pre></div>
</section><section id="load-additional-libraries" class="slide level2">
<h1>Load Additional Libraries</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(purrr)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(RColorBrewer)
<span class="kw">library</span>(magick)</code></pre></div>
</section><section id="visualize-pickups" class="slide level2">
<h1>Visualize Pickups</h1>
<h3 id="ggplot2-theme">ggplot2 Theme</h3>
<ul>
<li class="fragment"><code>ggplot</code> will give very aesthetically appealing plots by default</li>
<li class="fragment">However, it really shines in it’s ability to customize</li>
<li class="fragment">See the <code>ggthemes</code> for some template themes</li>
<li class="fragment">We’ll use the theme below inspired from <a href="https://twitter.com/minimaxir/status/628921315198566400">Max Woolf’s Tweet on this dataset</a></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">theme_map_dark &lt;-<span class="st"> </span>function(<span class="dt">palate_color =</span> <span class="st">&quot;Greys&quot;</span>) {
  
  palate &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(palate_color, <span class="dt">n=</span><span class="dv">9</span>)
  color.background =<span class="st"> &quot;black&quot;</span>
  color.grid.minor =<span class="st"> &quot;black&quot;</span>
  color.grid.major =<span class="st"> &quot;black&quot;</span>
  color.axis.text =<span class="st"> </span>palate[<span class="dv">1</span>]
  color.axis.title =<span class="st"> </span>palate[<span class="dv">1</span>]
  color.title =<span class="st"> </span>palate[<span class="dv">1</span>]
  
  font.title &lt;-<span class="st"> &quot;Source Sans Pro&quot;</span>
  font.axis &lt;-<span class="st"> &quot;Open Sans Condensed Bold&quot;</span>
  
  <span class="kw">theme_bw</span>(<span class="dt">base_size=</span><span class="dv">5</span>) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.background=</span><span class="kw">element_rect</span>(<span class="dt">fill=</span>color.background, <span class="dt">color=</span>color.background)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">plot.background=</span><span class="kw">element_rect</span>(<span class="dt">fill=</span>color.background, <span class="dt">color=</span>color.background)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.border=</span><span class="kw">element_rect</span>(<span class="dt">color=</span>color.background)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>()) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>()) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.ticks=</span><span class="kw">element_blank</span>()) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span>color.background)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">3</span>,<span class="dt">colour=</span>color.axis.title,<span class="dt">family=</span>font.axis)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), <span class="dt">legend.position=</span><span class="st">&quot;top&quot;</span>, <span class="dt">legend.direction=</span><span class="st">&quot;horizontal&quot;</span>) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.key.width=</span><span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">legend.key.height=</span><span class="kw">unit</span>(<span class="fl">0.25</span>, <span class="st">&quot;cm&quot;</span>), <span class="dt">legend.margin=</span><span class="kw">unit</span>(-<span class="fl">0.5</span>,<span class="st">&quot;cm&quot;</span>)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">plot.title=</span><span class="kw">element_text</span>(<span class="dt">colour=</span>color.title,<span class="dt">family=</span>font.title, <span class="dt">size=</span><span class="dv">14</span>)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">plot.subtitle =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span>color.title,<span class="dt">family=</span>font.title, <span class="dt">size=</span><span class="dv">12</span>)) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.x=</span><span class="kw">element_blank</span>()) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.y=</span><span class="kw">element_blank</span>()) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title.y=</span><span class="kw">element_blank</span>()) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title.x=</span><span class="kw">element_blank</span>()) +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span>color.background, 
                                          <span class="dt">color=</span>color.background),
          <span class="dt">strip.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">7</span>,<span class="dt">colour=</span>color.axis.title,<span class="dt">family=</span>font.title))
  
}</code></pre></div>
</section><section id="plot-function" class="slide level2">
<h1>Plot Function</h1>
<h3 id="complete-the-function-below">Complete the Function Below</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># x axis should be longitude</span>
<span class="co"># y axis should be latitude</span>
map_nyc &lt;-<span class="st"> </span>function(df, pickup_hr) {
  
  gplot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, 
                  <span class="kw">aes</span>(<span class="dt">x=</span>..., 
                      <span class="dt">y=</span>...)) +
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">color=</span><span class="st">&quot;white&quot;</span>, <span class="dt">size=</span><span class="fl">0.06</span>) +
<span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(min_long, max_long)) +
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(min_lat, max_lat)) +
<span class="st">    </span><span class="kw">theme_map_dark</span>() +<span class="st"> </span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Map of NYC Taxi Pickups&quot;</span>,
         <span class="dt">subtitle =</span> <span class="kw">paste0</span>(<span class="st">&quot;Pickups between &quot;</span>, pickup_hr))
  
  <span class="kw">return</span>(gplot)
  
}</code></pre></div>
</section><section id="iterate-and-plot" class="slide level2">
<h1>Iterate and Plot!</h1>
<h3 id="now-we-can-iterate-and-plot">Now we can Iterate and Plot</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hour_plots &lt;-<span class="st"> </span><span class="kw">ungroup</span>(pickups) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(num_pickups &gt;<span class="st"> </span><span class="dv">1</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">split</span>(.$pickup_hour) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">map</span>(~<span class="st"> </span><span class="kw">map_nyc</span>(.x, <span class="dt">pickup_hr =</span> .x$pickup_hour[<span class="dv">1</span>]))

hour_plots</code></pre></div>
</section><section id="summary-1" class="slide level2">
<h1>Summary</h1>
<dl>
<dt class="fragment">mutate</dt>
<dd class="fragment"><p>Create transformations</p>
</dd>
<dt class="fragment">summarise</dt>
<dd class="fragment"><p>Aggregate</p>
</dd>
<dt class="fragment">group_by</dt>
<dd class="fragment"><p>Group your dataset by levels</p>
</dd>
<dt class="fragment">do</dt>
<dd class="fragment"><p>Evaluate complex operations on a tbl</p>
</dd>
</dl>
<p>Chaining with the <code>%&gt;%</code> operator can result in more readable code.</p>
</section><section id="what-we-didnt-cover" class="slide level2">
<h1>What We Didn’t Cover</h1>
<ul>
<li class="fragment">There are many additional topics that fit well into the <code>dplyr</code> and functional programming landscape</li>
<li class="fragment">There are too many to cover in one session. Fortunately, most are well documented. The most notable omissions:</li>
</ul>
<ol type="1">
<li class="fragment">Connecting to remote databases, see <code>vignette('databases', package = 'dplyr')</code></li>
<li class="fragment">Merging and Joins, see <code>vignette('two-table', package = 'dplyr')</code></li>
<li class="fragment">Programming with <code>dplyr</code>,<code>vignette('nse', package = 'dplyr')</code></li>
<li class="fragment"><code>summarize_each</code> and <code>mutate_each</code></li>
</ol>
</section><section id="thanks-for-attending" class="slide level2">
<h1>Thanks for Attending!</h1>
<ul>
<li class="fragment">Any questions?</li>
</ul>
</section></section>
    </div>
  </div>

  <script src="1-intro-to-R_files/reveal.js-3.3.0/lib/js/head.min.js"></script>
  <script src="1-intro-to-R_files/reveal.js-3.3.0/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: true,
        // Transition style
        transition: 'default', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom


        // Optional reveal.js plugins
        dependencies: [
          { src: '1-intro-to-R_files/reveal.js-3.3.0/plugin/notes/notes.js', async: true },
          { src: '1-intro-to-R_files/reveal.js-3.3.0/plugin/zoom-js/zoom.js', async: true },
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
